# Quiz Bot — Telegram и ВКонтакте

Этот проект представляет собой двух ботов для викторин, работающих на одной базе вопросов. Боты задают случайные вопросы из истории, культуры и других областей, проверяют ответы и ведут счёт пользователей. Вопросы хранятся в Redis, что обеспечивает быстрый доступ и экономию памяти.

[@QuizMaster777Bot](https://t.me/QuizMaster777Bot) и [ВКонтакте](https://vk.com/club234376389)

![Video Project 4](https://github.com/user-attachments/assets/85316c0c-4f97-4873-b966-8c9ecd529bf4)                                 ![Video Project 7](https://github.com/user-attachments/assets/217c6581-2b3d-44fd-b29f-0e7975aff0eb)


**Возможности**

- Случайный вопрос по нажатию кнопки «Новый вопрос»
- Проверка ответа с учётом возможных пояснений (в скобках, после точки) и удалением лишних символов
- Подсказка «Сдаться» — показывает правильный ответ и сразу даёт новый вопрос
- Личный счёт пользователя (хранится в Redis)
- Удобное меню с кнопками в Telegram и ВКонтакте
- Более 300 000 вопросов, загруженных в Redis

**Требования**

- `Python 3.13` или выше
- `Redis` (локально или удалённо)
- Аккаунты `Telegram` (бот через @BotFather) и `ВКонтакте` (сообщество с включёнными сообщениями и клавиатурами)

## Установка

1. Клонируйте репозиторий
2. Создайте и активируйте виртуальное окружение (рекомендуется использовать uv или venv):

```bash
uv venv
source .venv/bin/activate   # для Linux/Mac
.\.venv\Scripts\activate    # или для Windows
```

3. Установите зависимости:

```bash
uv sync
```

## Настройка переменных окружения

Создайте файл `.env` в корне проекта со следующим содержимым:

```env
# Telegram
TG_TOKEN=ваш_токен_бота
ADMIN_CHAT_ID=ваш_telegram_id

# ВКонтакте
VK_GROUP_TOKEN=токен_сообщества_вк

# Redis (можно не указывать, если используются стандартные значения)
REDIS_HOST=localhost
REDIS_PORT=6379     # стандартный порт Redis
REDIS_DB=0          # номер базы данных (по умолчанию всегда 0, если не используется несколько баз)
```

**Где взять токены**

`Telegram`: @BotFather → /newbot → получить токен. ADMIN_CHAT_ID можно узнать у бота @userinfobot.

`ВКонтакте`:
- Создайте сообщество, в настройках включите «Сообщения сообщества» и «Long Poll API»
- В разделе «Работа с API» создайте ключ доступа (токен сообщества) с правами на сообщения
- Включите «Клавиатуры для ботов» (важно для отображения кнопок)

## Запуск Redis (локально)

**Linux/WSL:**

```bash
sudo service redis-server start
```

**Windows (через WSL2):** следуйте [инструкции по установке Redis в WSL]
(https://redis-docs.ru/operate/oss_and_stack/install/install-redis/install-redis-on-windows/)

## Загрузка вопросов в Redis

В репозитории находится архив `questions.zip`, содержащий файл `questions.json` со всеми вопросами (около 156 МБ в распакованном виде).  
Чтобы загрузить вопросы в Redis:

1. Распакуйте архив:
   - **Вручную** (через проводник или любой архиватор).
   - **Или командой** (для Linux/Mac/WSL):
     ```bash
     unzip questions.zip
     ```
   - **Для Windows (PowerShell)**:
     ```powershell
     Expand-Archive -Path questions.zip -DestinationPath .
     ```

2. Убедитесь, что Redis запущен (см. раздел «Запуск Redis»).

3. Выполните скрипт загрузки:
   ```bash
   python load_questions_to_redis.py
   ```

При успешной загрузке вы увидите сообщение:
```text
Загружено 326929 вопросов. Последний ID: 326928
```

*Важно: Redis должен быть запущен перед выполнением скрипта. Если Redis работает на другом хосте/порте, измените переменные в `.env`.*

## Работа с исходными файлами вопросов (опционально)

В репозитории также доступен архив `quiz-questions.zip`, содержащий более 4000 исходных `.txt` файлов, из которых был создан `questions.json`.  
Если вы хотите самостоятельно пересобрать базу вопросов (например, после редактирования), выполните следующие шаги:

1. Распакуйте архив:
   ```bash
   unzip questions_txt.zip -d questions
   ```
   (создаст папку `questions/` с текстовыми файлами)

2. Убедитесь, что у вас есть скрипт `generate_json.py` (он уже есть в репозитории).

3. Запустите генерацию JSON:
   ```bash
   python generate_json.py
   ```
   Будет создан новый файл `questions.json`, который затем можно загрузить в Redis через `load_questions_to_redis.py`.

**Примечание:** этот шаг необязателен. Для работы ботов достаточно готового `questions.json` из архива `questions.zip`.

## Запуск ботов

**Telegram-бот**

```bash
python bot_tg/tg_bot.py
```

**VK-бот**

```bash
python bot_vk/vk_bot.py
```

Оба бота запускаются независимо и могут работать одновременно.

## Проверка работы

**Telegram:** найдите своего бота по имени, отправьте /start или нажмите кнопку «start».

**ВКонтакте:** напишите сообщение в сообщество – бот ответит приветствием с клавиатурой.

Далее пользуйтесь кнопками:

- «Новый вопрос» – случайный вопрос.
- Ответьте текстом – бот проверит и сообщит результат.
- «Сдаться» – покажет правильный ответ и сразу даст новый вопрос.
- «Мой счёт» – количество правильных ответов.

## Структура проекта

```text
.
├── bot_tg/                       # Telegram-бот
│   ├── handlers.py               # обработчики сообщений
│   ├── keyboards.py              # клавиатуры
│   ├── states.py                 # состояния FSM
│   └── tg_bot.py                 # точка входа
├── bot_vk/                       # VK-бот
│   ├── keyboards.py              # клавиатуры
│   ├── vk_bot.py                 # точка входа
│   └── vk_handlers.py            # обработчики
├── .gitignore
├── load_questions_to_redis.py    # скрипт загрузки вопросов в Redis
├── questions.zip                 # архив с базой вопросов
├── logger.py                     # настройка логирования с отправкой ошибок в Telegram
├── pyproject.toml                # зависимости проекта
├── redis_client.py               # клиент Redis с функциями доступа
├── settings.py                   # чтение переменных окружения
├────────────────────────────────────────────────────────────────────────────────────────
├── quiz-questions.zip            # архив с исходными .txt файлами (опционально)
├── question.py                   # функция извлечения вопросов из .txt
└── generate_json.py              # скрипт для создания questions.json из исходных .txt
```

## Примечания

- Для корректного распознавания ответов боты удаляют пояснения в скобках, обрезают текст до точки, убирают кавычки и лишние пробелы.
- Счёт и текущий вопрос каждого пользователя хранятся в Redis с временем жизни 1 час.
- Если Redis не запущен, боты не смогут обрабатывать вопросы – проверьте статус Redis перед запуском.

### Цель проекта

Код написан в образовательных целях на онлайн-курсе для веб-разработчиков [dvmn.org](https://dvmn.org/).
